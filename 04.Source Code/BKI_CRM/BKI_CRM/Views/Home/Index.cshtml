@{
    ViewBag.Title = "Index";
    Layout = "~/Views/_LayoutCRM.cshtml";
    var lst_khach_hang = ViewBag.khach_hang as List<BKI_CRM.Models.KhachHangModel>;
    var lst_trang_thai = ViewBag.LstTrangThai as List<BKI_CRM.Model.DM_TRANG_THAI>;
}
		<div class="title">
			<h3>CHUYỂN TRẠNG THÁI KHÁCH HÀNG</h3>
		</div> 
		<div class="content">
			<div class="data">
				<div class="control-group">
					<div class="controls">
						<div class="input-prepend">
							<input class="span3" id="inputIcon" type="text">
							<span class="add-on"><i class="icon-search"></i></span>							
						</div>
					</div>
				</div>
				<table class="table table-condensed table-font-size">
					<tr class="table_header">
						<td>Tên khách hàng</td>
						<td>Sản phẩm - Dịch vụ</td>
						<td>Hiện tại</td>
						<td>Tiếp theo</td>
						<td>Ghi chú</td>
						<td>Chia sẻ</td>
					</tr>
                    @foreach (var item in lst_khach_hang)
                    {
                        <tr class="item-table">
						    <td><button class="btn btn-success btn120" type="button" onclick="LayThongTinKhachHang('@item.ID')">@item.TEN_KHACH_HANG</button></td>
						    <td>@item.TEN_SAN_PHAM @item.TEN_SAN_PHAM_CHI_TIET</td>
						    <td><a href="#" id="@item.ID_TRANG_THAI" onclick="showLevelDefine()">@item.MA_TRANG_THAI</a></td>
						    <td>
                                @foreach (var item2 in item.LstChuyenTrangThai)
                                {
                                    if (item2.LOAI_TRANG_THAI_YN)
                                    {
                                        <button class="btn btn-success btn80" type="button" onclick="chuyentrangthai('@item.ID_TRANG_THAI','@item2.ID_TRANG_THAI_SAU','@item2.MA_TRANG_THAI')"><i class="icon-hand-up"></i> @item2.MA_TRANG_THAI</button>    
                                    }
                                    else
                                    {
                                        <button class="btn btn-danger btn80" type="button" onclick="chuyentrangthai('@item.ID_TRANG_THAI','@item2.ID_TRANG_THAI_SAU','@item2.MA_TRANG_THAI')"><i class="icon-hand-down"></i> @item2.MA_TRANG_THAI</button>
                                    }                                    
                                }
						    </td>
						    <td>@item.GHI_CHU</td>
						    <td>
							    <button class="btn btn-primary" type="button" onclick="showShare()"><i class="icon-share"></i> Chia sẻ</button>
						    </td>
					    </tr>
                    }					
				</table>
			</div>
		</div>
        
    <div id="infoCustomer" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		    <div class="modal-header">
			    <h3>THÔNG TIN KHÁCH HÀNG</h3>
		    </div>
		    <div class="modal-body">
			    <div class="info">
				    <div class="left">
					    <img class="image-size" id="image"/>
				    </div>
				    <div class="left" style="margin-left:20px;">
					    <div class="clear-both">
						    <div class="dimention1 bold">Họ tên</div>
						    <div class="left"><input id="hoten" type="text" placeholder="Type something…"></div>
					    </div>
					    <div class="clear-both">
						    <div class="dimention1 bold">Loại khách hàng</div>
						    <div class="left"><input id="loaikhachhang" type="text" placeholder="Type something…"></div>
					    </div>
					    <div class="clear-both">
						    <div class="dimention1 bold">SĐT</div>
						    <div class="left"><input id="sdt" type="text" placeholder="Type something…"></div>
					    </div>
					    <div class="clear-both">
						    <div class="dimention1 bold">Địa chỉ</div>
						    <div class="left"><input id="diachi" type="text" placeholder="Type something…"></div>
					    </div>
					    <div class="clear-both">
						    <div class="dimention1 bold">Email</div>
						    <div class="left"> <input id="email" type="text" placeholder="Type something…"></div>
					    </div>
				    </div>
			    </div>
		    </div>
		    <div class="modal-header">
			    <h3>LỊCH SỬ KHÁCH HÀNG</h3>
		    </div>
		    <div class="modal-body" id="lichsukh">
			    
		    </div>
		    <div class="modal-footer">
			    <a href="#" class="btn btn-primary" onclick="hideInfoCustomer()">Lưu lại</a>
			    <a href="#" class="btn" onclick="hideInfoCustomer()">Đóng</a>
		    </div>
	    </div>
	
	<div id="levelDefine" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<h3>ĐỊNH NGHĨA TRẠNG THÁI KHÁCH HÀNG</h3>
		</div>
		<div class="modal-body">
			<p>
                <ol>
                    @foreach (var item in lst_trang_thai)
                    {
                        <li>@item.MA_TRANG_THAI : là @item.MO_TA</li>    
                    }
                </ol>
			</p>
		</div>
		<div class="modal-footer">
			<a href="#" class="btn" onclick="hideLevelDefine()">Đóng</a>
		</div>
	</div>
	
	<div id="share" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<h3>CHIA SẺ KHÁCH HÀNG</h3>
		</div>
		<div class="modal-body">
			Khách hàng: <b>Phạm Hoàng Thái</b><br/><br/>
			Người có quyền quản lý khách hàng
			<div class="share-item">
				<div class="left" style="width:250px;">Nguyễn Danh Tú</div>
				<div class="left role">Chủ nhân</div>
				<div class="right"><a href="#"><i class="icon-remove"></i></a></div>
			</div>
			<div class="share-item">
				<div class="left" style="width:250px;">Phạm Quốc Thắng</div>
				<div class="left role">Có quyền quản lý</div>
				<div class="right"><a href="#"><i class="icon-remove"></i></a></div>
			</div>
			<div class="share-item">
				<div class="left" style="width:250px;">
					<select>
						<option>Nguyễn Danh Tú</option>
						<option>Phạm Quốc Thắng</option>
						<option selected="selected">Nguyễn Văn Trịnh</option>
					</select>
				</div>
				<div class="left">
					<select>
						<option>Chủ nhân</option>
						<option selected="selected">Có quyền quản lý</option>
					</select>
				</div>
				<div class="right"><a href="#"><i class="icon-plus"></i></a></div>
			</div>
			<div class="clear-both">
				<label class="checkbox">
					<input type="checkbox" style="margin: -2px 0 0;"> Xóa bỏ khách hàng này trong danh sách của tôi.
				</label>
			</div>
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" type="button">Lưu lại</button>
			<a href="#" class="btn" onclick="hideShare()">Đóng</a>
		</div>
	</div>
	
	<div id="note" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<h3>GHI CHÚ CHUYỂN TRẠNG THÁI</h3>
		</div>
		<div class="modal-body">
			<h4>Các yêu cầu để chuyển trạng thái khách hàng từ <span id="ma_trang_thai_truoc"></span> sang <span id="ma_trang_thai_sau"></span></h4>
            <div id="yeucau">
			    ghi dữ liệu
            </div>	
		</div>
		<div class="modal-footer">
			<button class="btn btn-primary" type="button">Lưu lại</button>
			<a href="#" class="btn" onclick="hideNote()">Đóng</a>
		</div>
	</div>
    <script type="text/javascript">
        function LayThongTinKhachHang(id_khach_hang) {
            $.ajax({
                url: '/Home/LayThongTinKhachHang',
                data: { ip_str_id_khach_hang: id_khach_hang },
                dataType: "json",
                type: "POST",
                error: function () {
                    alert("Xay ra loi");
                },
                success: function (data) {
                    hoten.value = data.TEN_KHACH_HANG;
                    sdt.value = data.SDT;
                    diachi.value = data.DIA_CHI;
                    email.value = data.EMAIL;
                    image.src = "/Content/image/" + data.THONG_TIN_BO_SUNG_01;
                }
            });
            $.ajax({
                url: '/Home/LayLichSuKhachHang',
                data: { ip_str_id_khach_hang: id_khach_hang },
                dataType: "json",
                type: "POST",
                error: function () {
                    alert("Xay ra loi");
                },
                success: function (data) {
                    optionhtml = "";
                    $.each(data, function (i) {
                        if (data[i].LOAI_TRANG_THAI_YN == true) {
                            optionhtml += "<p>" + data[i].TEN_SAN_PHAM + " " + data[i].TEN_SAN_PHAM_CHI_TIET + " --- Trạng thái <span class='blue bold'>" + data[i].MA_TRANG_THAI +"</span></p>";
                        }
                        else {
                            optionhtml += "<p>" + data[i].TEN_SAN_PHAM + " " + data[i].TEN_SAN_PHAM_CHI_TIET + " --- Trạng thái <span class='red bold'>" + data[i].MA_TRANG_THAI + "</span></p>";
                        }
                    });
                    document.getElementById('lichsukh').innerHTML = optionhtml;
                }
            });
            $('#infoCustomer').modal('show');        
        }

        function chuyentrangthai(id_trang_thai_truoc, id_trang_thai_sau, mtt_sau) {
            ma_trang_thai_truoc.innerHTML = document.getElementById(id_trang_thai_truoc).innerHTML;
            ma_trang_thai_sau.innerHTML = mtt_sau;
            $.ajax({
                url: '/Home/LayYeuCauTrangThai',
                data: { ip_str_id_trang_thai: id_trang_thai_sau },
                dataType: "json",
                type: "POST",
                error: function () {
                    alert("Xay ra loi");
                },
                success: function (data) {
                    var optionhtml = "";
                    $.each(data, function (i) {
                        optionhtml += "<div>";
                        optionhtml += "<div class='left div240'>"+data[i].YEU_CAU+"</div>";
                        optionhtml += "<div class='left div50'><input type='checkbox'/></div>";
                        optionhtml += "<div class='left'><input type='text' placeholder='Số tiền' id='money'/></div>";
                        optionhtml += "<div class='right div240'><input type='text' placeholder='Ghi chú'/></div>";
                        optionhtml += "</div>";
                    });
                    document.getElementById('yeucau').innerHTML = optionhtml;
                }
            });
            $('#note').modal('show');
        }
	
	    function hideInfoCustomer(){
		    $('#infoCustomer').modal('hide');
	    }
	
	    function showLevelDefine(){
		    $('#levelDefine').modal('show');
	    }
	
	    function hideLevelDefine(){
		    $('#levelDefine').modal('hide');
	    }
	
	    function showShare(){
		    $('#share').modal('show');
	    }
	
	    function hideShare(){
		    $('#share').modal('hide');
	    }
	
	    function hideNote(){
		    $('#note').modal('hide');
	    }
    </script>